---
sidebar_position: 2
---
# FCM Registration

## Overview
This document describes how to configure the push notification feature in the GCCS authentication process.

<br/>

## Feature Description
There can be a circumstance when the user requests GCCS authentication from a non-mobile platform such as the web or window.  
To receive the push notification in the mobile app that has implemented the Android SDK, FCM registration and the token update feature is necessary.

## FCM Server key 

In order to receive the push notifications, the server key generated by Firebase Cloud Messaging (FCM) must be sent together with the client issuance request.
The FCM server key can be found in the process below.
1. Create or load the project in the [Firebase Console](https://console.firebase.google.com/).
2. [Project Settings] > get the Server Key from [Cloud Messaging] menu.

If the client needs registration, note that the FCM server key is indispensable.


## FCM Push notification token registration
FCM push token should be registered so that it can be used for notifying authentication request.
By using the `registerPushToken()` from `GuardianSdk`, the FCM push token that was generated from the Android device can be called to be registered and updated.

FCM push token can be changed due to expiration, etc. It should be updated by calling `registerPushToken()`.

### Parameter
|Key|Value|Description|
|------|---|---|
|token|String|FCM push notification token|

### Example
```java
// FCM Push notification token registered
FirebaseInstanceId.getInstance().getInstanceId()
    .addOnSuccessListener(new OnSuccessListener<InstanceIdResult>() {
        public void onSuccess(InstanceIdResult instanceIdResult) {
            String token = instanceIdResult.getToken();

            GuardianSdk.getInstance().registerPushToken(token, new GuardianResponseCallback<TokenResponse>() {
                @Override
                public void onSuccess(TokenResponse result) {
                    Log.i(TAG, "Result code : " + result.rtCode);
                }
                @Override
                public void onFailed(ErrorResult errorResult) {
                    Log.e(TAG, "Error code : " + errorResult.getErrorCode());
                }
            });
        }
});

// FCM Push notification token renewed
public class FirebasePushService extends FirebaseMessagingService {
    @Override
    public void onMessageReceived(RemoteMessage remoteMessage) {
    }

    @Override
    public void onNewToken(String token) {
        super.onNewToken(token);
        GuardianSdk.getInstance().registerPushToken(token, new GuardianResponseCallback<TokenResponse>() {
            @Override
            public void onSuccess(TokenResponse result) {
                Log.i(TAG, "Result code : " + result.rtCode);
            }

            @Override
            public void onFailed(ErrorResult errorResult) {
                Log.e(TAG, "Error code : " + errorResult.getErrorCode());
            }
        });
    }
}
```
### TokenResponse
|Key|Value|Description|
|------|---|---|
|rtCode|0|Result code|
|rtMsg|String|Result message|

If the API call to register FCM push token is successful, the `rtCode` will be `0`

### ErrorResult
|Key|Value|Description|
|------|---|---|
|errorCode|Int|Error code|
|errorMessage|String|Error message|

If API call fails, the user will receive an `errorCode`

## FCM Push notification token removal
FCM push token can be deleted from the Android device by using `deregisterPushToken()` of `GuardianSdk`   
Once the token is deleted, users can't receive the push notification when they request for authentication.

### Parameter
- none

### Example
```java
// FCM push notification token removal
GuardianSdk.getInstance().deregisterPushToken(new GuardianResponseCallback<TokenResponse>() {
    @Override
    public void onSuccess(TokenResponse result) {
        Log.i(TAG, "Result code : " + result.rtCode);
    }

    @Override
    public void onFailed(ErrorResult errorResult) {
        Log.e(TAG, "Error code : " + errorResult.getErrorCode());
    }
});
```
### TokenResponse
|Key|Value|Description|
|------|---|---|
|rtCode|0|Result code|
|rtMsg|String|Result message|

If the API call to delete FCM push token is successful, the `rtCode` will be `0`

### ErrorResult
|Key|Value|Description|
|------|---|---|
|errorCode|Int|Error code|
|errorMessage|String|Error message|

If API call fails, the user will receive an `errorCode`